<ion-header *ngIf="room">
  <ion-navbar color="primary">
    <ion-buttons right>
      <button ion-button menuToggle>
          <ion-icon name="menu"></ion-icon>
        </button>
    </ion-buttons>
    <!-- 방이름/인원 -->
    <ion-title> {{room.hostName}}방장 ({{room.currentPeople}}/{{room.capacity}}) </ion-title>
  </ion-navbar>

  <!-- 방 정보 -->
  <ion-grid id="room-info">
    <ion-row>
      <ion-col justify-content-center padding-left>
        {{displayDate}} {{displayTime}}
        <p><b>{{room.depart}} &nbsp; <ion-icon name="arrow-forward"></ion-icon>
           &nbsp; {{room.arrive}}
        </b></p>
        <p>{{room.departTime}}</p>
      </ion-col>
      <ion-col col-auto>
        <ion-buttons right icon-only>
          <!-- 먹튀 방지용으로 방나가기는 택시 이용 시간 직전까지만 사용 가능-->
          <button class="quit" *ngIf="room.departDate + room.departTime > dateServices.nowDate + dateServices.nowTime" ion-button (click)='room.transportType=="carpool" ? quitCarpool():quit()'>
            <span>방나가기</span>
          </button>
          <!-- 택시 타고 난 이후 정산 기능-->
          <button class="payment" *ngIf="room.departDate + room.departTime <= dateServices.nowDate + dateServices.nowTime" ion-button (click)='room.transportType=="carpool" ? paymentCarpool():payment()'>
              <span>정산하기</span>
            </button>
        </ion-buttons>
      </ion-col>
    </ion-row>
  </ion-grid>

  <!-- 참여자 정보  -->
  <ion-grid id="part-info">
    <ion-row>
      <ion-col class="users">
        <div class="user" *ngFor="let member of participants; let i = index">
          <button class="user-name" [ngClass]="{'active': index==i}" (click)="show(i)" >{{ member.korName }}</button>
          <button class="user-call"><a href="sms://{{member.phoneNumber}}"><ion-icon name="ios-call-outline"></ion-icon></a></button>
          <button class="user-mail"><a href="sms://{{member.phoneNumber}}"><ion-icon name="ios-mail-outline"></ion-icon></a></button>
        </div>
        <div class="user dumy" *ngIf="!participants.length">
          <button class="user-name"></button>
        </div>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-header>

<ion-content>
  <ion-list>
    <div class="message-wrap" *ngFor="let chat of chats | async; let last = last">
      <!-- 밑에 주석처리 되어있는 부분이 내가 말한 내용이면 오른쪽, 상대가 말한 내용이면 왼쪽 선택하게한다. -->
      <div class="message right" *ngIf="chat.userID == userID">
        <!-- <img class="user-img" [src]="msg.userAvatar" alt="" src=""> 이거는 프로필사진-->
        <div class="user-info">
          <img *ngIf="chat.userID == roomHost" src="assets/img/crown_gold.png" alt="Host">{{chat.userName}}
        </div>
        
        <div class="msg-content">
          <span>{{chat.dateTime | DatePipe}}</span>
          <div class="msg-info">
            <span>{{chat.content}}</span>
          </div>
        </div>
      </div>

      <div class="message" *ngIf="chat.userID == 'CRA'">
        <div class="msg-content">
          <div class="notification">
            {{chat.content}}
          </div>
        </div>
      </div>
      
      <div class="message left" *ngIf="(chat.userID != userID) && (chat.userID != 'CRA')">
        <!-- <img class="user-img" alt="" src=""> -->
        <div class="user-info">
          <img *ngIf="chat.userID == roomHost" src="assets/img/crown_gold.png" alt="Host">{{chat.userName}}
        </div>
        <div class="msg-content">
          <div class="msg-info">
            <span>{{chat.content}}</span>
          </div>
          <span>{{chat.dateTime}}</span>
        </div>
      </div>
    </div>
  </ion-list>
</ion-content>

<ion-footer>
  <form (ngSubmit)="send()">
    <ion-item>
      <ion-input type="text" name="contents" [(ngModel)]="chatContent" fixed transportType="text" ></ion-input>
      <button type="submit" ion-button clear item-right > send </button>
    </ion-item>
  </form>
</ion-footer>
